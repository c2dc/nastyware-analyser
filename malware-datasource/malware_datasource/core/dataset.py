import json
import pandas as pd

MALWARE_SOURCES_FILE = 'malware_sources.json'

class Dataset:
    def __init__(self, source_data, source):
        self.source_data = source_data
        self.source = source

        with open(MALWARE_SOURCES_FILE) as f:
            malware_sources = json.load(f)

        data = {}

        for malware_source in malware_sources:
            if malware_sources[malware_source]['template'] is None: # TESTAR ISSO AQUI
                continue
            
            self._add_keys_to_dict(data, malware_sources[malware_source]['template'])

        for key in source_data:
            # check if malware_sources[source]['template'][key] exist in dict
            if not key in malware_sources[source]['template']:
                continue

            data[malware_sources[source]['template'][key]] = source_data[key]

        self.data = pd.json_normalize(data)
    
    def to_csv(self, header=False, index=False):
        return self.data.to_csv(header=header, index=index)

    def _add_keys_to_dict(self, data, template):
        for key in template:
            if isinstance(template[key], dict):
                data[key] = {}
                self._add_keys_to_dict(data[key], template[key])
            else:
                data[template[key]] = None