#!/usr/bin/env python3

import json
from malware_datasource.utils.malware_sources import MalwareSources
from malware_datasource.core.datasource_malware_bazaar import DataSourceMalwareBazaar
from malware_datasource.core.datasource_url_haus import DataSourceUrlHaus

malware_sources = MalwareSources('malware_sources.json')

for source in malware_sources.sources:
    if source == malware_sources.MALWARE_BAZAAR:
        datasource = DataSourceMalwareBazaar(malware_sources.sources[malware_sources.MALWARE_BAZAAR])
    elif source == malware_sources.URL_HAUS:
        datasource = DataSourceUrlHaus(malware_sources.sources[malware_sources.URL_HAUS])

    json_information = datasource.request_json_information(hash=datasource.known_hash)
    malware_sources.sources[source]['template'] = json_information

with open('malware_sources.json', 'w') as f:
    json.dump(malware_sources.sources, f, indent=4)

